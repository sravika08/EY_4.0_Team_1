{% extends 'base.html' %}

{% block title %}My Attendance Details - College Attendance Management System{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h2 style="color: #2c3e50;">
                <i class="fas fa-clipboard-list"></i> My Attendance Details
            </h2>
            <p class="text-muted">{{ student.name }} ({{ student.hall_ticket_id }})</p>
        </div>
        <div class="col-auto">

    <!-- Read-Only Notice -->
    <div class="alert alert-info border-bottom mb-4" role="alert">
        <i class="fas fa-lock"></i> <strong>READ-ONLY VIEW:</strong> This is your detailed attendance history. You can view your attendance records but cannot make any changes.
    </div>
            <a href="{% url 'student_dashboard' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="stat-box">
                <div class="stat-value">{{ total_classes }}</div>
                <div class="stat-label">Total Classes</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-box">
                <div class="stat-value" style="color: #27ae60;">{{ attended_classes }}</div>
                <div class="stat-label">Attended</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-box">
                <div class="stat-value" style="color: #e74c3c;">
                    {{ absent_classes }}
                </div>
                <div class="stat-label">Absent</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-box">
                <div class="stat-value" style="color: #3498db;">{{ attendance_percentage }}%</div>
                <div class="stat-label">Percentage</div>
            </div>
        </div>
    </div>

    <!-- Attendance Table -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-table"></i> Complete Attendance Records
            <span class="badge badge-primary float-end">{{ total_classes }} Records</span>
        </div>
        
        {% if attendance_records %}
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Date</th>
                        <th>Subject</th>
                        <th>Topic</th>
                        <th>Faculty</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for attendance in attendance_records %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <strong>{{ attendance.schedule.date|date:"d/m/Y" }}</strong><br>
                            <small class="text-muted">{{ attendance.schedule.date|date:"l" }}</small>
                        </td>
                        <td>{{ attendance.schedule.subject }}</td>
                        <td>{{ attendance.schedule.topic }}</td>
                        <td>{{ attendance.schedule.faculty.name }}</td>
                        <td>
                            {% if attendance.status == 'P' %}
                            <span class="badge badge-success">
                                <i class="fas fa-check-circle"></i> Present
                            </span>
                            {% else %}
                            <span class="badge badge-danger">
                                <i class="fas fa-times-circle"></i> Absent
                            </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="card-body">
            <div class="alert alert-info mb-0" role="alert">
                <i class="fas fa-info-circle"></i>
                No attendance records available yet. Please check back later.
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Statistics and Tips -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info">
                    <i class="fas fa-lightbulb"></i> Attendance Tips
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-arrow-right text-primary"></i>
                            <strong>Maintain 75%+ Attendance:</strong> This is required for academic regulations.
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-arrow-right text-primary"></i>
                            <strong>Every Class Matters:</strong> Each absent class reduces your percentage.
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-arrow-right text-primary"></i>
                            <strong>Plan Ahead:</strong> Know your current percentage to plan accordingly.
                        </li>
                        <li class="mb-0">
                            <i class="fas fa-arrow-right text-primary"></i>
                            <strong>Contact Faculty:</strong> If you have legitimate reasons for absence, inform faculty.
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success">
                    <i class="fas fa-chart-pie"></i> Attendance Summary
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <p class="mb-2">
                            <strong>Current Status:</strong>
                            {% if attendance_percentage >= 75 %}
                            <span class="badge badge-success">Good</span>
                            {% elif attendance_percentage >= 50 %}
                            <span class="badge badge-warning">At Risk</span>
                            {% else %}
                            <span class="badge badge-danger">Critical</span>
                            {% endif %}
                        </p>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" 
                                 data-width="{{ attendance_percentage }}" 
                                 aria-valuenow="{{ attendance_percentage }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                            </div>
                        </div>
                    </div>
                    <script>
                    (function() { var el = document.querySelector('[data-width]'); if(el) el.style.width = el.getAttribute('data-width') + '%'; })();
                    </script>
                    <hr>
                    <p class="mb-2">
                        <i class="fas fa-calendar-check"></i>
                        <strong>Attended:</strong> {{ attended_classes }} out of {{ total_classes }} classes
                    </p>
                    <p class="mb-2">
                        <i class="fas fa-percentage"></i>
                        <strong>Percentage:</strong> {{ attendance_percentage }}%
                    </p>
                    <p class="mb-0">
                        <i class="fas fa-calendar-alt"></i>
                        <strong>Last Updated:</strong> Today
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .badge-primary {
        background-color: #3498db;
        color: white;
    }
    .badge-success {
        background-color: #27ae60;
        color: white;
    }
    .badge-danger {
        background-color: #e74c3c;
        color: white;
    }
    .badge-warning {
        background-color: #f39c12;
        color: white;
    }
</style>
{% endblock %}
